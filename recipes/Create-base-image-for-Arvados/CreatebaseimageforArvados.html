<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=XGMkxXUZTA64h2imyzu79g);.lst-kix_gezii5f3kbvg-2>li:before{content:"\0025a0   "}.lst-kix_3qqhyyvk0bxp-0>li{counter-increment:lst-ctn-kix_3qqhyyvk0bxp-0}ol.lst-kix_3qqhyyvk0bxp-1.start{counter-reset:lst-ctn-kix_3qqhyyvk0bxp-1 0}.lst-kix_gezii5f3kbvg-3>li:before{content:"\0025cf   "}ol.lst-kix_3qqhyyvk0bxp-8.start{counter-reset:lst-ctn-kix_3qqhyyvk0bxp-8 0}.lst-kix_3qqhyyvk0bxp-5>li{counter-increment:lst-ctn-kix_3qqhyyvk0bxp-5}.lst-kix_gezii5f3kbvg-5>li:before{content:"\0025a0   "}.lst-kix_gezii5f3kbvg-4>li:before{content:"\0025cb   "}.lst-kix_3qqhyyvk0bxp-6>li{counter-increment:lst-ctn-kix_3qqhyyvk0bxp-6}.lst-kix_gezii5f3kbvg-7>li:before{content:"\0025cb   "}.lst-kix_gezii5f3kbvg-6>li:before{content:"\0025cf   "}.lst-kix_ydpah29hj5kd-4>li:before{content:"\0025cb   "}ol.lst-kix_3qqhyyvk0bxp-5.start{counter-reset:lst-ctn-kix_3qqhyyvk0bxp-5 0}.lst-kix_3qqhyyvk0bxp-7>li{counter-increment:lst-ctn-kix_3qqhyyvk0bxp-7}.lst-kix_3qqhyyvk0bxp-1>li{counter-increment:lst-ctn-kix_3qqhyyvk0bxp-1}.lst-kix_gezii5f3kbvg-8>li:before{content:"\0025a0   "}.lst-kix_ydpah29hj5kd-3>li:before{content:"\0025cf   "}.lst-kix_ydpah29hj5kd-7>li:before{content:"\0025cb   "}.lst-kix_ydpah29hj5kd-0>li:before{content:"\0025cf   "}.lst-kix_ydpah29hj5kd-8>li:before{content:"\0025a0   "}.lst-kix_ydpah29hj5kd-2>li:before{content:"\0025a0   "}.lst-kix_ydpah29hj5kd-1>li:before{content:"\0025cb   "}ol.lst-kix_3qqhyyvk0bxp-2.start{counter-reset:lst-ctn-kix_3qqhyyvk0bxp-2 0}.lst-kix_ydpah29hj5kd-6>li:before{content:"\0025cf   "}.lst-kix_ydpah29hj5kd-5>li:before{content:"\0025a0   "}.lst-kix_3qqhyyvk0bxp-4>li{counter-increment:lst-ctn-kix_3qqhyyvk0bxp-4}ol.lst-kix_3qqhyyvk0bxp-3{list-style-type:none}ol.lst-kix_3qqhyyvk0bxp-4{list-style-type:none}ul.lst-kix_gezii5f3kbvg-7{list-style-type:none}ol.lst-kix_3qqhyyvk0bxp-5{list-style-type:none}ul.lst-kix_gezii5f3kbvg-8{list-style-type:none}ol.lst-kix_3qqhyyvk0bxp-6{list-style-type:none}ul.lst-kix_gezii5f3kbvg-5{list-style-type:none}ol.lst-kix_3qqhyyvk0bxp-7{list-style-type:none}ul.lst-kix_gezii5f3kbvg-6{list-style-type:none}ol.lst-kix_3qqhyyvk0bxp-8{list-style-type:none}ul.lst-kix_gezii5f3kbvg-3{list-style-type:none}ul.lst-kix_gezii5f3kbvg-4{list-style-type:none}.lst-kix_3qqhyyvk0bxp-3>li{counter-increment:lst-ctn-kix_3qqhyyvk0bxp-3}ol.lst-kix_3qqhyyvk0bxp-6.start{counter-reset:lst-ctn-kix_3qqhyyvk0bxp-6 0}.lst-kix_3qqhyyvk0bxp-8>li{counter-increment:lst-ctn-kix_3qqhyyvk0bxp-8}.lst-kix_3qqhyyvk0bxp-2>li{counter-increment:lst-ctn-kix_3qqhyyvk0bxp-2}ul.lst-kix_gezii5f3kbvg-1{list-style-type:none}ul.lst-kix_ydpah29hj5kd-0{list-style-type:none}ul.lst-kix_gezii5f3kbvg-2{list-style-type:none}ul.lst-kix_ydpah29hj5kd-1{list-style-type:none}ul.lst-kix_ydpah29hj5kd-2{list-style-type:none}ul.lst-kix_gezii5f3kbvg-0{list-style-type:none}ul.lst-kix_ydpah29hj5kd-3{list-style-type:none}ul.lst-kix_ydpah29hj5kd-4{list-style-type:none}ol.lst-kix_3qqhyyvk0bxp-0{list-style-type:none}ol.lst-kix_3qqhyyvk0bxp-3.start{counter-reset:lst-ctn-kix_3qqhyyvk0bxp-3 0}ul.lst-kix_ydpah29hj5kd-5{list-style-type:none}ol.lst-kix_3qqhyyvk0bxp-1{list-style-type:none}ul.lst-kix_ydpah29hj5kd-6{list-style-type:none}ol.lst-kix_3qqhyyvk0bxp-2{list-style-type:none}ul.lst-kix_ydpah29hj5kd-7{list-style-type:none}.lst-kix_3qqhyyvk0bxp-1>li:before{content:"" counter(lst-ctn-kix_3qqhyyvk0bxp-1,lower-latin) ". "}ul.lst-kix_ydpah29hj5kd-8{list-style-type:none}.lst-kix_3qqhyyvk0bxp-0>li:before{content:"" counter(lst-ctn-kix_3qqhyyvk0bxp-0,decimal) ". "}.lst-kix_3qqhyyvk0bxp-4>li:before{content:"" counter(lst-ctn-kix_3qqhyyvk0bxp-4,lower-latin) ". "}ol.lst-kix_3qqhyyvk0bxp-0.start{counter-reset:lst-ctn-kix_3qqhyyvk0bxp-0 0}.lst-kix_3qqhyyvk0bxp-3>li:before{content:"" counter(lst-ctn-kix_3qqhyyvk0bxp-3,decimal) ". "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_3qqhyyvk0bxp-2>li:before{content:"" counter(lst-ctn-kix_3qqhyyvk0bxp-2,lower-roman) ". "}.lst-kix_gezii5f3kbvg-1>li:before{content:"\0025cb   "}.lst-kix_gezii5f3kbvg-0>li:before{content:"\0025cf   "}.lst-kix_3qqhyyvk0bxp-8>li:before{content:"" counter(lst-ctn-kix_3qqhyyvk0bxp-8,lower-roman) ". "}.lst-kix_3qqhyyvk0bxp-5>li:before{content:"" counter(lst-ctn-kix_3qqhyyvk0bxp-5,lower-roman) ". "}ol.lst-kix_3qqhyyvk0bxp-4.start{counter-reset:lst-ctn-kix_3qqhyyvk0bxp-4 0}ol.lst-kix_3qqhyyvk0bxp-7.start{counter-reset:lst-ctn-kix_3qqhyyvk0bxp-7 0}.lst-kix_3qqhyyvk0bxp-7>li:before{content:"" counter(lst-ctn-kix_3qqhyyvk0bxp-7,lower-latin) ". "}.lst-kix_3qqhyyvk0bxp-6>li:before{content:"" counter(lst-ctn-kix_3qqhyyvk0bxp-6,decimal) ". "}ol{margin:0;padding:0}table td,table th{padding:0}.c26{padding-top:0pt;padding-bottom:3pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c29{color:#666666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Arial";font-style:normal}.c5{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c30{padding-top:14pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c24{padding-top:16pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c10{padding-top:20pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c13{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:"Arial";font-style:normal}.c22{color:#434343;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Arial";font-style:normal}.c7{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:26pt;font-family:"Arial";font-style:normal}.c8{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c27{color:#000000;text-decoration:none;vertical-align:baseline;font-size:10pt;font-style:normal}.c3{color:#000000;text-decoration:none;vertical-align:baseline;font-size:11pt;font-style:normal}.c19{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c12{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c11{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c14{color:inherit;text-decoration:inherit}.c23{padding:0;margin:0}.c17{border:1px solid black;margin:5px}.c21{margin-left:36pt;padding-left:0pt}.c1{font-weight:400;font-family:"Roboto Mono"}.c15{background-color:#d9ead3}.c20{background-color:#ffe599}.c4{height:11pt}.c16{background-color:#9fc5e8}.c6{background-color:#b6d7a8}.c18{font-weight:700}.c9{text-indent:36pt}.c25{background-color:#ffd966}.c28{background-color:#f4cccc}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}
    </style>
  </head>
  <body class="c11 doc-content">
    <p class="c9 c26 title" id="h.lb7fen9dpo7i">
      <span class="c7">Create base image for Arvados
      </span>
    </p>
    <p class="c2">
      <span class="c0">The purpose is to create an Ubuntu 22.04 virtual guest image that can serve as a starting point for single-host Arvados installation (the &ldquo;base image&rdquo;).
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">In addition, some configuration will be done on the host in order to support the guest based on the image.
      </span>
    </p>
    <h1 class="c10" id="h.pumw96eazo6e">
      <span class="c13">Host preparations
      </span>
    </h1>
    <h2 class="c5" id="h.2t1nx96slx6">
      <span class="c8">Install host OS
      </span>
    </h2>
    <p class="c2">
      <span>Install Ubuntu 22.04 &ldquo;jammy
      </span>
      <span>&rdquo; [
      </span>
      <span class="c28">Follow other instructions for the R7; link TBA
      </span>
      <span>]
      </span>
      <sup>
	<a href="#cmnt1" id="cmnt_ref1">[a]
	</a>
      </sup>
      <sup>
	<a href="#cmnt2" id="cmnt_ref2">[b]
	</a>
      </sup>
      <sup>
	<a href="#cmnt3" id="cmnt_ref3">[c]
	</a>
      </sup>
      <sup>
	<a href="#cmnt4" id="cmnt_ref4">[d]
	</a>
      </sup>
    </p>
    <p class="c2">
      <span>Make sure you have &ldquo;sudo&rdquo; privileges (this is the default with the first user) or you are root.
      </span>
    </p>
    <h2 class="c5" id="h.6v09pftzny3o">
      <span class="c8">Install virtualization tools in host
      </span>
    </h2>
    <p class="c2">
      <span class="c0">Install the following packages:
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">sudo apt install virt-manager libvirt-clients
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Optional:
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">sudo apt install libguestfs-tools
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Enable libvirt daemon (optional, should be enabled automatically upon successful installation)
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sudo systemctl enable --now libvirtd.service
      </span>
    </p>
    <h3 class="c24" id="h.yjfudwpkehtk">
      <span class="c22">Gain libvirt operator privilege
      </span>
    </h3>
    <p class="c2">
      <span class="c0">Check that the group &ldquo;libvirt&rdquo; exists:
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getent group | grep libvirt
      </span>
    </p>
    <p class="c2">
      <span class="c0">You should see the group listed. Then, add yourself to the &ldquo;libvirt&rdquo; group
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sudo usermod -aG libvirt &quot;$(id -nu)&quot;
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">To take effect, the easiest way is to kill all of the current user&rsquo;s processes and log back in:
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sudo killall -u &quot;$(id -nu)&quot;
      </span>
    </p>
    <p class="c2">
      <span>(Note that the above shell expansion using the
      </span>
      <span class="c1">id
      </span>
      <span>&nbsp;command is okay with sudo, because it gets expanded before being passed to
      </span>
      <span class="c1">sudo
      </span>
      <span class="c0">&nbsp;as an argument).
      </span>
    </p>
    <a id="kix.2kswmb7odka3">
    </a>
    <h2 class="c5" id="h.thbqfpmswauf">
      <span class="c8">Download guest OS image (Ubuntu 22.04.5)
      </span>
    </h2>
    <p class="c2">
      <span>Download the initial guest OS image from here (dated
      </span>
      <span>Oct 24, 2024
      </span>
      <span class="c0">):
      </span>
    </p>
    <p class="c2 c9">
      <span class="c12">
	<a class="c14" href="https://www.google.com/url?q=https://releases.ubuntu.com/22.04/ubuntu-22.04.5-desktop-amd64.iso&amp;sa=D&amp;source=editors&amp;ust=1745010509578142&amp;usg=AOvVaw2mmxTSBB4J6s8sGJRkdQrQ">https://releases.ubuntu.com/22.04/ubuntu-22.04.5-desktop-amd64.iso
	</a>
      </span>
    </p>
    <p class="c2">
      <span>This is the GNOME GUI edition, which is preferable to the server edition because you can run Firefox out of the box in the guest, which will be useful for testing.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Its SHA256 checksum is
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">bfd1cee02bc4f35db939e69b934ba49a39a378797ce9aee20f6e3e3e728fefbf
      </span>
    </p>
    <p class="c2 c4">
      <span class="c3 c1">
      </span>
    </p>
    <p class="c2">
      <span class="c0">After the download finishes, check data integrity:
      </span>
    </p>
    <p class="c2">
      <span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sha256sum
      </span>
      <span class="c3 c1">ubuntu-22.04.5-desktop-amd64.iso
      </span>
    </p>
    <p class="c2">
      <span class="c0">You should see the above checksum.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Set its file ownership:
      </span>
    </p>
    <p class="c2">
      <span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sudo chown libvirt-qemu:kvm ubuntu-22.04.5-desktop-amd64.iso
      </span>
    </p>
    <a id="id.tsixnbe4fzhq">
    </a>
    <h2 class="c5" id="h.cmh6idn71px">
      <span class="c8">Configure virtual LAN for guests
      </span>
    </h2>
    <h3 class="c24" id="h.hg95ns196c1x">
      <span class="c22">Rationale and domain structure
      </span>
    </h3>
    <p class="c2">
      <span class="c0">What this does is basically to run a local-only mini DNS registrar.
      </span>
    </p>
    <ul class="c23 lst-kix_ydpah29hj5kd-0 start">
      <li class="c2 c21 li-bullet-0">
	<span class="c0">First we will have a &ldquo;base&rdquo; domain name which refers to this particular host network-interface that is connected to the guests.
	</span>
      </li>
      <li class="c2 c21 li-bullet-0">
	<span class="c0">Then for each guest (even if we have just one for now), there is a separate subdomain that is entirely in our control and not subject to any considerations about the 5-character &ldquo;cluster ID&rdquo;.
	</span>
      </li>
      <li class="c2 c21 li-bullet-0">
	<span class="c0">The Arvados cluster&rsquo;s domain name(s) will live one further level under the guest domain name. A requirement of the Arvados multi-hostname installer is that the 5-character cluster ID should go into a level of subdomain.
	</span>
      </li>
    </ul>
    <p class="c2">
      <span class="c0">Example:
      </span>
    </p>
    <p class="c2 c9">
      <span class="c1 c16">xyzzy
      </span>
      <span class="c1">.
      </span>
      <span class="c1 c20">demo
      </span>
      <span class="c1">.
      </span>
      <span class="c3 c1 c6">some-domain
      </span>
    </p>
    <p class="c2">
      <span class="c0">Here
      </span>
    </p>
    <ul class="c23 lst-kix_gezii5f3kbvg-0 start">
      <li class="c2 c21 li-bullet-0">
	<span class="c1 c16">xyzzy
	</span>
	<span>&nbsp;
	</span>
	<span class="c0">is the cluster ID, as a level of subdomains
	</span>
      </li>
      <li class="c2 c21 li-bullet-0">
	<span class="c1 c20">demo
	</span>
	<span class="c0">&nbsp;is the name of the guest
	</span>
      </li>
      <li class="c2 c21 li-bullet-0">
	<span class="c1 c6">some-domain
	</span>
	<span class="c0">&nbsp;is the base domain for this host-guest combination (and also a name for the host)
	</span>
      </li>
    </ul>
    <p class="c2">
      <span>In fact, any domain in the form of
      </span>
      <span class="c1">*.
      </span>
      <span class="c1">demo
      </span>
      <span class="c1">.
      </span>
      <span class="c1">some-domain
      </span>
      <span>&nbsp;will be CNAMEs for
      </span>
      <span class="c1">demo
      </span>
      <span class="c1">.
      </span>
      <span class="c1">some-domain
      </span>
      <span>, no matter how many levels of subdomains there are in the
      </span>
      <span class="c1">*
      </span>
      <span>.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>Domain name is necessary, even for &ldquo;single-host single-domain&rdquo; installation (source: Readme files under src directory
      </span>
      <span class="c1">salt-install/config_examples/single_host
      </span>
      <span class="c0">)
      </span>
    </p>
    <h3 class="c24" id="h.cyq8miwosjdf">
      <span class="c22">Check virtual network
      </span>
    </h3>
    <p class="c2">
      <span>First, ensure that the
      </span>
      <span class="c1">libvirtd
      </span>
      <span class="c0">&nbsp;service is running.
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;systemctl status libvirtd.service
      </span>
    </p>
    <p class="c2">
      <span class="c0">If it is not running, enable it:
      </span>
    </p>
    <p class="c2">
      <span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sudo systemctl enable --now libvirtd.service
      </span>
    </p>
    <p class="c2">
      <span class="c0">Check that the virtual bridge interface exists:
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">ip link show dev virbr0
      </span>
    </p>
    <p class="c2">
      <span>This should show the information about interface
      </span>
      <span class="c1">virbr0
      </span>
      <span>. If not, check the output of
      </span>
      <span class="c1">ip link show
      </span>
      <span>&nbsp;for the bridge interface. We will assume that
      </span>
      <span class="c1">virbr0
      </span>
      <span class="c0">&nbsp;is the name of the interface.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Make sure that the command
      </span>
    </p>
    <p class="c2 c9">
      <span class="c1">virsh net-dumpxml default
      </span>
    </p>
    <p class="c2">
      <span>shows something.
      </span>
    </p>
    <h3 class="c24" id="h.d9gmqbknpztc">
      <span class="c22">Choose a localized DNS domain for the virtual network
      </span>
    </h3>
    <p class="c2">
      <span>We will name this network (consisting of the host and TBA guests) so we can deal with names rather than IP addresses. Recommended: use a subdomain under the
      </span>
      <span class="c1">.home.arpa
      </span>
      <span>&nbsp;hierarchy, following
      </span>
      <span class="c12">
	<a class="c14" href="https://www.google.com/url?q=https://datatracker.ietf.org/doc/html/rfc8375&amp;sa=D&amp;source=editors&amp;ust=1745010509584902&amp;usg=AOvVaw0tsJ4aFBx5_g9tSy9URdLQ">RFC 8375
	</a>
      </span>
      <span class="c0">. This hierarchy is not globally resolvable and is strictly localized to the virtual network.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>Example: let&rsquo;s choose the name
      </span>
      <span class="c1 c6">vir-test.home.arpa
      </span>
      <span>. This domain name as a host name will refer to the KVM host. Each guest will be assigned a domain name under that, for example
      </span>
      <span class="c1 c6">demo.vir-test.home.arpa
      </span>
      <span>. The IP network (
      </span>
      <span class="c25">192.168.60.0/24
      </span>
      <span class="c0">) in the example config can be anything as long as it doesn&#39;t cause a conflict with other networks.
      </span>
    </p>
    <h3 class="c24" id="h.llhuv7o2omsv">
      <span class="c22">Edit default virtual network profile
      </span>
    </h3>
    <p class="c2">
      <span class="c0">To do this, we begin with the dump of the current network definition file:
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;virsh net-dumpxml default &gt; default.xml
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>Edit
      </span>
      <span class="c1">default.xml
      </span>
      <span class="c0">&nbsp;so it looks like this:
      </span>
    </p>
    <h4 class="c30" id="h.b6sk9sscie9">
      <span>Content of
      </span>
      <span class="c29">&nbsp;network profile
      </span>
    </h4>
    <p class="c2">
      <span class="c1">&lt;network xmlns:dnsmasq=&#39;
      </span>
      <span class="c1">http://libvirt.org/schemas/network/dnsmasq/1.0
      </span>
      <span class="c3 c1">&#39; ipv6=&#39;yes&#39;&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &lt;name&gt;default&lt;/name&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &lt;uuid&gt;[...]&lt;/uuid&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &lt;forward mode=&#39;nat&#39;&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &nbsp; &lt;nat&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &nbsp; &nbsp; &lt;port start=&#39;1024&#39; end=&#39;65535&#39;/&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &nbsp; &lt;/nat&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &lt;/forward&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &lt;bridge name=&#39;virbr0&#39; stp=&#39;on&#39; delay=&#39;0&#39;/&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c1">&nbsp; &lt;mac address=
      </span>
      <span class="c1">&#39;
      </span>
      <span class="c1 c25">[...]
      </span>
      <span class="c3 c1">&#39;/&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c1">&nbsp; &lt;domain name=&#39;
      </span>
      <span class="c1 c6">vir-test.home.arpa
      </span>
      <span class="c3 c1">&#39; localOnly=&#39;yes&#39;/&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c1">&nbsp; &lt;ip address=&#39;
      </span>
      <span class="c1 c25">192.168.60.1
      </span>
      <span class="c3 c1">&#39; netmask=&#39;255.255.255.0&#39;&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &nbsp; &lt;dhcp&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c1">&nbsp; &nbsp; &nbsp; &lt;range start=&#39;
      </span>
      <span class="c1 c25">192.168.60.2
      </span>
      <span class="c1">&#39; end=&#39;
      </span>
      <span class="c1 c25">192.168.60.254
      </span>
      <span class="c3 c1">&#39;/&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &nbsp; &lt;/dhcp&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &lt;/ip&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &lt;dnsmasq:options&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &nbsp; &lt;dnsmasq:option value=&#39;dns-loop-detect&#39;/&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &nbsp; &lt;dnsmasq:option value=&#39;domain-needed&#39;/&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &nbsp; &lt;dnsmasq:option value=&#39;no-hosts&#39;/&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c1">&nbsp; &nbsp; &lt;dnsmasq:option value=&#39;auth-zone=
      </span>
      <span class="c1 c6">vir-test.home.arpa
      </span>
      <span class="c3 c1">,virbr0,exclude:127.0.0.1/8&#39;/&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c1">&nbsp; &nbsp; &lt;dnsmasq:option value=&#39;auth-server=
      </span>
      <span class="c1 c6">vir-test.home.arpa
      </span>
      <span class="c3 c1">,&#39;/&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c1">&nbsp; &nbsp; &lt;dnsmasq:option value=&#39;host-record=
      </span>
      <span class="c1 c6">vir-test.home.arpa
      </span>
      <span class="c1">,
      </span>
      <span class="c1 c25">192.168.60.1
      </span>
      <span class="c3 c1">&#39;/&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c1">&nbsp; &nbsp; &lt;dnsmasq:option value=&#39;cname=*.demo.
      </span>
      <span class="c1 c6">vir-test.home.arpa
      </span>
      <span class="c1">,demo.
      </span>
      <span class="c1 c6">vir-test.home.arpa
      </span>
      <span class="c3 c1">&#39;/&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &lt;/dnsmasq:options&gt;
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&lt;/network&gt;
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Then, re-import the network definition file:
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">virsh net-destroy default
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">virsh net-define default.xml --validate
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">virsh net-start default
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">sudo systemctl restart libvirtd.service
      </span>
    </p>
    <h3 class="c24" id="h.y6qm0316igkp">
      <span class="c22">Configure host DNS for virtual LAN
      </span>
    </h3>
    <p class="c2">
      <span>To make it possible to resolve virtual guests&#39; DNS names, install the
      </span>
      <span class="c1">systemd-resolved
      </span>
      <span class="c0">&nbsp;hooks for virtual networks. This will let systemd-resolved (the default domain name resolution mechanism) dynamically respond to changes in the virtual network (e.g. a guest being brought online)
      </span>
    </p>
    <p class="c2 c9">
      <span class="c1">git clone
      </span>
      <span class="c1">https://github.com/zoe-translates/libvirt-systemd-resolved
      </span>
      <span class="c3 c1">&nbsp;&amp;&amp; cd libvirt-systemd-resolved
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">sudo make install
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">sudo systemctl restart systemd-resolved.service libvirtd.service
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>After that, it&#39;s possible to use partial domain names for the online guests from the virtual network. For example, if the guest&#39;s hostname is
      </span>
      <span class="c1">demo
      </span>
      <span>, we&#39;ll be able to use &quot;
      </span>
      <span class="c1">ssh demo
      </span>
      <span>&quot; for remote login, without having to type the FQDN or IP address.
      </span>
    </p>
    <h1 class="c10" id="h.ualw1rrtbqzu">
      <span class="c13">Create and configure guest
      </span>
    </h1>
    <p class="c2">
      <span class="c0">We&rsquo;re going to use the Virtual Machine Manager GUI app. Start it from the Ubuntu applications list. In the app menu, click on &ldquo;Edit&rdquo; -&gt; &ldquo;Preferences&rdquo;. Select &ldquo;Enable XML editing&rdquo;, and save.
      </span>
    </p>
    <p class="c2">
      <span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 452.00px;">
	<img alt="" src="images/image4.png" style="width: 624.00px; height: 452.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="">
      </span>
    </p>
    <h2 class="c5" id="h.mzsz962j3571">
      <span class="c8">Add new virtual machine
      </span>
    </h2>
    <p class="c2">
      <span class="c0">Click on the &ldquo;Create a new virtual machine&rdquo; icon:
      </span>
    </p>
    <p class="c2">
      <span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 180.00px;">
	<img alt="" src="images/image2.png" style="width: 624.00px; height: 180.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="">
      </span>
    </p>
    <p class="c2">
      <span class="c0">You will see a new dialog with the text &ldquo;Step 1 of 5&rdquo;
      </span>
    </p>
    <p class="c2">
      <span>Step 1. Choose &ldquo;Local install media&rdquo; (this will refer to the
      </span>
      <span class="c12">
	<a class="c14" href="#id.wrz4fcarkqe2">Ubuntu 22.04 image we just downloaded
	</a>
      </span>
      <span class="c0">). Click on &ldquo;Forward&rdquo;
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>Step 2. Click on &ldquo;Browse&rdquo; to locate the installation media. The easiest way is to click on &ldquo;
      </span>
      <span class="c15">Browse Local
      </span>
      <span class="c0">&rdquo; in the ensuing file locator dialog, and choose the Ubuntu 22.04 ISO image. You will see the OS is automatically identified as such.
      </span>
    </p>
    <p class="c2">
      <span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 458.67px;">
	<img alt="" src="images/image3.png" style="width: 624.00px; height: 458.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Step 3. Provision the amount of RAM and virtual CPU cores. Suggested values are 40960 MiB of RAM and 8 cores.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Step 4. Allocate storage for the guest. I&rsquo;d recommend 150 GiB for testing purposes.
      </span>
    </p>
    <hr style="page-break-before:always;display:none;">
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>Step 5. Name the virtual machine. Here, name it &ldquo;
      </span>
      <span class="c1 c6">demo
      </span>
      <span class="c0">&rdquo;. This will be used as hostname. Make sure &ldquo;Customize configuration before install&rdquo; is checked
      </span>
    </p>
    <p class="c2">
      <span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 608.00px; height: 612.00px;">
	<img alt="" src="images/image7.png" style="width: 608.00px; height: 612.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Click on &ldquo;Finish&rdquo;. You&rsquo;ll see a new dialog. Under &ldquo;Firmware&rdquo;, choose &ldquo;UEFI&rdquo;. Click on &ldquo;Apply&rdquo;.
      </span>
    </p>
    <p class="c2">
      <span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 518.67px;">
	<img alt="" src="images/image5.png" style="width: 624.00px; height: 518.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="">
      </span>
      <span class="c0">&nbsp;
      </span>
    </p>
    <p class="c2">
      <span class="c0">Click on the &ldquo;Memory&rdquo; in the left-side panel, choose &ldquo;Enable shared memory&rdquo;, then Apply.
      </span>
    </p>
    <p class="c2">
      <span class="c0">Finally, click on &ldquo;Begin Installation&rdquo; on the top of the dialog. The new virtual guest will be created and we will boot directly into Ubuntu installer.
      </span>
    </p>
    <p class="c2">
      <span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 546.67px;">
	<img alt="" src="images/image8.png" style="width: 624.00px; height: 546.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="">
      </span>
    </p>
    <h2 class="c5" id="h.fbz303ygbysl">
      <span class="c8">Install guest OS
      </span>
    </h2>
    <p class="c2">
      <span class="c0">In the boot menu, choose &ldquo;Try or Install Ubuntu&rdquo;. In the GUI dialog that follows, choose &ldquo;English&rdquo; in the panel on the left, and &ldquo;Install Ubuntu&rdquo; on the right.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Choose both &ldquo;English (US)&rdquo; for the keyboard and language selection step; click on &ldquo;Continue&rdquo;.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Choose &ldquo;Minimal installation&rdquo; in the &ldquo;Updates and other software&rdquo; step. Optionally, choose &ldquo;Download updates while installing Ubuntu&rdquo; if you have a fast mirror. Click on &ldquo;Continue&rdquo;
      </span>
    </p>
    <p class="c2">
      <span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 548.00px;">
	<img alt="" src="images/image1.png" style="width: 624.00px; height: 548.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="">
      </span>
    </p>
    <p class="c2">
      <span class="c0">In the next step, choose &ldquo;Erase disks and install Ubuntu&rdquo;. Don&rsquo;t select advanced features (i.e. Don&rsquo;t use LVM or disk encryption). Click on &ldquo;Install Now&rdquo;.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>You&rsquo;ll be greeted with a world map. Type &ldquo;Boston&rdquo; in the search area. This step is actually sort of consequential, because it will determine your default locale settings and the software update mirror if you chose to update OS while installing. Choose anywhere in the US and you get the locale
      </span>
      <span class="c1">en_US.UTF-8
      </span>
      <span class="c0">.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">The next step is &ldquo;Who are you?&rdquo;. For our testing purposes, let&rsquo;s use a fixed name. Type &ldquo;Arvados Demo&rdquo; as &ldquo;Your name&rdquo; (this corresponds to the user&#39;s full name).
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>Type &ldquo;
      </span>
      <span class="c6">demo
      </span>
      <span class="c0">&rdquo; in &ldquo;Your computer&rsquo;s name&rdquo;. (i.e. this is the same as the guest&rsquo;s subdomain)
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>In &ldquo;Pick a username&rdquo;, type all-lowercase
      </span>
      <span class="c1">arvdev
      </span>
      <span class="c0">. Set a password.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">For convenience I recommend selecting &ldquo;Log in automatically&rdquo;.
      </span>
    </p>
    <p class="c2">
      <span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 548.00px;">
	<img alt="" src="images/image6.png" style="width: 624.00px; height: 548.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title="">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Wait for the installation to finish.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Follow the on-screen instructions to reboot. Test that the new guest boots.
      </span>
    </p>
    <h2 class="c5" id="h.w1ufvpk5lxet">
      <span class="c8">First-time boot
      </span>
    </h2>
    <p class="c2">
      <span class="c0">You&rsquo;ll log in as arvdev. You&rsquo;ll be asked to connect your online accounts. Choose &ldquo;Skip&rdquo;. Then, also skip Ubuntu Pro settings. Then, select &ldquo;No, don&rsquo;t send system info&rdquo; and click on &ldquo;Next&rdquo;. Skip the &ldquo;Location services&rdquo; step. Click on &ldquo;Done&rdquo;.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">If you are asked &ldquo;A new version of Ubuntu is available. Would you like to upgrade?&rdquo; choose &ldquo;Don&rsquo;t Upgrade&rdquo;. (Upgrade refers to major Ubuntu release upgrade)
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">You may be asked to install security updates by the software-updater app, and you should do so. This will also update the kernel so you need to reboot the guest to take advantage of that.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">To prevent automatic screen locking, go to GNOME preferences menu (top right corner -&gt; Settings) -&gt; Privacy -&gt; Screen; set &ldquo;Blank Screen Delay&rdquo; to &ldquo;Never&rdquo;, deselect &ldquo;Automatic Screen Lock&rdquo;.
      </span>
    </p>
    <h2 class="c5" id="h.jjrhautloa22">
      <span class="c8">Check that local DNS settings are working
      </span>
    </h2>
    <p class="c2">
      <span class="c12">
	<a class="c14" href="#id.tsixnbe4fzhq">Cf. Virtual LAN and DNS settings.
	</a>
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>In the
      </span>
      <span class="c18">host
      </span>
      <span class="c0">&nbsp;machine, try pinging the guest:
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ping demo
      </span>
    </p>
    <p class="c2">
      <span class="c0">This should work out of the box.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">The command
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolvectl query demo
      </span>
    </p>
    <p class="c2">
      <span class="c0">should give you more detailed info like the following:
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c1">demo:
      </span>
      <span class="c1 c20">192.168.60.217
      </span>
      <span class="c3 c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- link: virbr0
      </span>
    </p>
    <p class="c2">
      <span class="c1">&nbsp; &nbsp; &nbsp; (
      </span>
      <span class="c1 c6">demo.vir-test.home.arpa
      </span>
      <span class="c3 c1">)
      </span>
    </p>
    <p class="c2 c4">
      <span class="c3 c1">
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">-- Information acquired via protocol DNS in 2.6ms.
      </span>
    </p>
    <p class="c2">
      <span class="c1 c3">-- Data is authenticated: no; Data was acquired via local or encrypted transport: no
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">-- Data from: cache network
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>Notice that the short name &ldquo;
      </span>
      <span class="c1 c6">demo
      </span>
      <span class="c0">&rdquo; is automatically matched to the FQDN.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>Inside the
      </span>
      <span class="c18">guest
      </span>
      <span class="c0">, similarly you should get the host&rsquo;s name info with the command
      </span>
    </p>
    <p class="c2">
      <span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolvectl query
      </span>
      <span class="c3 c1 c6">vir-test.home.arpa
      </span>
    </p>
    <p class="c2 c4">
      <span class="c3 c1">
      </span>
    </p>
    <p class="c2">
      <span class="c1 c6">vir-test.home.arpa
      </span>
      <span class="c1">:
      </span>
      <span class="c1 c20">192.168.60.1
      </span>
      <span class="c3 c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- link: enp1s0
      </span>
    </p>
    <p class="c2 c4">
      <span class="c3 c1">
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">-- Information acquired via protocol DNS in 2.0ms.
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">-- Data is authenticated: no; Data was acquired via local or encrypted transport: no
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">-- Data from: network
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Furthermore, arbitrary levels of subdomains should point to the same guest:
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">resolvectl query y.x.demo.vir-test.home.arpa
      </span>
    </p>
    <p class="c2 c4">
      <span class="c3 c1">
      </span>
    </p>
    <p class="c2">
      <span class="c1">y.x.demo.vir-test.home.arpa:
      </span>
      <span class="c1 c20">192.168.60.217
      </span>
      <span class="c3 c1">&nbsp; &nbsp; -- link: virbr0
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(demo.vir-test.home.arpa)
      </span>
    </p>
    <p class="c2 c4">
      <span class="c3 c1">
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">-- Information acquired via protocol DNS in 2.7ms.
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">-- Data is authenticated: no; Data was acquired via local or encrypted transport: no
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">-- Data from: network
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>The above example should work
      </span>
      <span class="c18">both
      </span>
      <span>&nbsp;from the
      </span>
      <span class="c18">host
      </span>
      <span>&nbsp;and from the
      </span>
      <span class="c18">guest
      </span>
      <span>. (Implemented as CNAME records; e.g. see output of
      </span>
      <span class="c1">dig y.x.demo.vir-test.home.arpa
      </span>
      <span class="c0">)
      </span>
    </p>
    <h2 class="c5" id="h.b7ukvbu1yneb">
      <span class="c8">Set up root account (optional, may make life easier)
      </span>
    </h2>
    <p class="c2">
      <span class="c0">By default, root user on Ubuntu is disabled.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>In the
      </span>
      <span class="c18">guest
      </span>
      <span class="c0">&nbsp;machine, open a GNOME terminal. Type
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">sudo passwd root
      </span>
    </p>
    <p class="c2">
      <span>Then, first type the
      </span>
      <span class="c1">arvdev
      </span>
      <span>&nbsp;(i.e. the current) user&rsquo;s password to raise privilege. Then, choose a password for root, and enter it at the prompt &ldquo;
      </span>
      <span class="c1">New password:
      </span>
      <span class="c0">&rdquo;
      </span>
    </p>
    <h2 class="c5" id="h.sf3mzrct5uji">
      <span class="c8">Set up passwordless sudo
      </span>
    </h2>
    <p class="c2">
      <span class="c0">This is required by the Arvados installer.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">In the guest machine, do this:
      </span>
    </p>
    <p class="c2">
      <span class="c1 c27">echo &quot;%sudo ALL=(ALL:ALL) NOPASSWD:ALL&quot; | sudo tee /etc/sudoers.d/nopass
      </span>
    </p>
    <a id="id.lavy1o5ddnuv">
    </a>
    <h2 class="c5" id="h.iaxw6wuteejz">
      <span class="c8">Install tools in guest
      </span>
    </h2>
    <p class="c2 c9">
      <span class="c3 c1">sudo apt update
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">sudo apt install git openssh-server python-is-python3
      </span>
    </p>
    <p class="c2">
      <span>If the command
      </span>
      <span class="c1">dpkg --print-foreign-architectures
      </span>
      <span class="c0">&nbsp;shows &ldquo;i386&rdquo;, you may want to remove it
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sudo dpkg --remove-architecture i386
      </span>
    </p>
    <h2 class="c5" id="h.b8vhb38zm4iz">
      <span class="c8">Install and configure Docker
      </span>
    </h2>
    <p class="c2">
      <span>Following these instructions on configuring cgroups 1 and Docker CE:
      </span>
      <span class="c12">
	<a class="c14" href="https://www.google.com/url?q=https://doc.arvados.org/main/install/install-docker.html&amp;sa=D&amp;source=editors&amp;ust=1745010509608477&amp;usg=AOvVaw2u6uvhnOtFjZYzLJAmUfIX">https://doc.arvados.org/main/install/install-docker.html
	</a>
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>The following instructions are for operating in the
      </span>
      <span class="c18">guest
      </span>
      <span>.
      </span>
    </p>
    <a id="id.6ntsfczgor1g">
    </a>
    <h3 class="c24" id="h.rpsqxq1l3khb">
      <span>Install Docker CE
      </span>
    </h3>
    <p class="c2">
      <span class="c0">Follow the steps detailed in the article:
      </span>
    </p>
    <p class="c2">
      <span class="c12">
	<a class="c14" href="https://www.google.com/url?q=https://docs.docker.com/engine/install/ubuntu/%23install-using-the-repository&amp;sa=D&amp;source=editors&amp;ust=1745010509609422&amp;usg=AOvVaw2q6P7RZfPUwXLOTof5VQ9p">https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository
	</a>
      </span>
      <span class="c0">&nbsp;(Install [Docker] using the apt repository)
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>See also:
      </span>
      <span class="c12">
	<a class="c14" href="https://www.google.com/url?q=https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-22-04&amp;sa=D&amp;source=editors&amp;ust=1745010509610070&amp;usg=AOvVaw093zkjvpxjM76geuL_bJJW">https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-22-04
	</a>
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span class="c0">Including the part about adding the current user to the docker group:
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sudo usermod -aG docker arvdev
      </span>
    </p>
    <h2 class="c5" id="h.pgyz376mzdw1">
      <span class="c8">Install PostgreSQL
      </span>
    </h2>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sudo apt install postgresql postgresql-contrib
      </span>
    </p>
    <h2 class="c5" id="h.t15xq6rmlshg">
      <span class="c8">Create user on host for Arvados installation
      </span>
    </h2>
    <p class="c2">
      <span>I recommend that a separate user account on the host be used for Arvados installation and post-installation admin. This account (called
      </span>
      <span class="c1">arvdev
      </span>
      <span class="c0">&nbsp;below) has no sudo privileges, and it manages its own dedicated SSH keys and configs in its home directory. This step is optional.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>On the
      </span>
      <span class="c18">host
      </span>
      <span>&nbsp;system, create the
      </span>
      <span class="c1">arvdev
      </span>
      <span class="c0">&nbsp;user.
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">useradd -G libvirt arvdev
      </span>
    </p>
    <p class="c2">
      <span class="c0">followed by setting the user&rsquo;s new password. This also adds the host&rsquo;s arvdev user to the libvirt group for convenience.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>Either log in as the new arvdev user on host, or use the
      </span>
      <span class="c1">su
      </span>
      <span class="c0">&nbsp;command to switch to it
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;su -l arvdev
      </span>
    </p>
    <h3 class="c24" id="h.t9vyetjbhv0m">
      <span class="c22">Create SSH keys for guest admin
      </span>
    </h3>
    <p class="c2">
      <span>When you are already the arvdev user on
      </span>
      <span class="c18">host
      </span>
      <span class="c0">, create a pair of new SSH keys. I recommend new keys specifically for the purpose of Arvados installation/development/testing.
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">ssh-keygen -t ed25519
      </span>
    </p>
    <p class="c2">
      <span class="c0">Then follow the prompts. For convenience, do not add a passphrase to the newly generated private key.
      </span>
    </p>
    <a id="id.lydkxdbwgjal">
    </a>
    <h3 class="c24" id="h.7fcg93v18s8k">
      <span class="c22">Run SSH agent as arvdev user on host
      </span>
    </h3>
    <p class="c2">
      <span class="c0">To use the keys, create an SSH agent session
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ssh-agent bash -l
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ssh-add
      </span>
    </p>
    <p class="c2">
      <span class="c0">You should see output like the following, without ever being prompted for passphrase:
      </span>
    </p>
    <p class="c2">
      <span class="c1">Identity added: /home/arvdev/.ssh/id_ed25519 (arvdev@r7c)
      </span>
      <span class="c0">&nbsp;
      </span>
    </p>
    <h3 class="c24" id="h.xrh1pr8a4pm4">
      <span class="c22">Enable and use new SSH key in guest
      </span>
    </h3>
    <p class="c2">
      <span>Now use Virtual Machine Manager to open the running
      </span>
      <span class="c18">guest
      </span>
      <span>. There, make sure
      </span>
      <span>sshd is running
      </span>
      <span>&nbsp;(The OpenSSH daemon is installed in the step &quot;
      </span>
      <span class="c12">
	<a class="c14" href="#id.lavy1o5ddnuv">Install tools in the guest
	</a>
      </span>
      <span>&quot;; if it is not yet installed in the guest, please do
      </span>
      <span class="c1">sudo apt install openssh-server
      </span>
      <span class="c0">)
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">systemctl status ssh.service
      </span>
    </p>
    <p class="c2">
      <span class="c0">If sshd is not running, enable it:
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">sudo systemctl enable --now ssh.service
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>Now go back to the
      </span>
      <span class="c18">host
      </span>
      <span class="c0">&nbsp;with a running session logged in as arvdev. There, issue the command
      </span>
    </p>
    <p class="c2 c9">
      <span class="c1">ssh-copy-id
      </span>
      <span class="c3 c1 c6">demo
      </span>
    </p>
    <p class="c2">
      <span class="c0">and follow the on-screen instructions. This will copy the new public key to the guest. To test if it works, the command
      </span>
    </p>
    <p class="c2 c9">
      <span class="c1">ssh
      </span>
      <span class="c3 c1 c6">demo
      </span>
    </p>
    <p class="c2">
      <span class="c0">should land you right into a shell session in the guest.
      </span>
    </p>
    <h1 class="c10" id="h.iftuvqe6n5s1">
      <span class="c13">Prepare for Arvados installation
      </span>
    </h1>
    <p class="c2">
      <span>Cf.
      </span>
      <span class="c12">
	<a class="c14" href="https://www.google.com/url?q=https://doc.arvados.org/main/install/salt-single-host.html&amp;sa=D&amp;source=editors&amp;ust=1745010509616245&amp;usg=AOvVaw0ftJQ1Kx4rUPqFkVBXDUIO">https://doc.arvados.org/main/install/salt-single-host.html
	</a>
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>On the
      </span>
      <span class="c18">host
      </span>
      <span class="c0">, stay in the arvdev user&rsquo;s shell session with an SSH agent.
      </span>
    </p>
    <a id="id.fdmgdjjaea9d">
    </a>
    <h2 class="c5" id="h.mhfivwfwlfoz">
      <span class="c8">Clone Arvados repo
      </span>
    </h2>
    <p class="c2">
      <span>The host will be the &ldquo;cluster console&rdquo; that controls the Arvados installation in the guest
      </span>
      <span class="c1">demo
      </span>
      <span class="c0">.
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>In the
      </span>
      <span class="c18">host
      </span>
      <span class="c0">, install git
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sudo apt update
      </span>
    </p>
    <p class="c2">
      <span class="c3 c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sudo apt install git
      </span>
    </p>
    <p class="c2 c4">
      <span class="c0">
      </span>
    </p>
    <p class="c2">
      <span>In the
      </span>
      <span class="c18">host
      </span>
      <span>, the following creates a directory
      </span>
      <span class="c1">$HOME/src
      </span>
      <span class="c0">&nbsp;and the Arvados source repo in it.
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">cd
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">mkdir src
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">cd src
      </span>
    </p>
    <p class="c2 c9">
      <span class="c1">git clone
      </span>
      <span class="c1">https://github.com/arvados/arvados.git
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">cd arvados
      </span>
    </p>
    <p class="c2 c9">
      <span class="c3 c1">git checkout main
      </span>
    </p>
    <h1 class="c10" id="h.qu3avptt6pqt">
      <span class="c13">Next steps
      </span>
    </h1>
    <p class="c2">
      <span class="c12">
	<a class="c14" href="https://www.google.com/url?q=https://docs.google.com/document/d/1w6DQqR3D65DcTCpMX51RrDvz547bYImCrPoY8A71-bE/edit?usp%3Dsharing&amp;sa=D&amp;source=editors&amp;ust=1745010509618433&amp;usg=AOvVaw0W5MVy4NFkqbzqZP3ysbLX">Install the development version
	</a>
      </span>
      <span class="c0">&nbsp;of Arvados packages (dkpg).
      </span>
    </p>
    <div class="c17">
      <p class="c19">
	<a href="#cmnt_ref1" id="cmnt1">[a]
	</a>
	<span class="c0">Why can&#39;t we make one image that works with both?
	</span>
      </p>
    </div>
    <div class="c17">
      <p class="c19">
	<a href="#cmnt_ref2" id="cmnt2">[b]
	</a>
	<span class="c0">Do you mean for both the storage &amp; compute devices?
	</span>
      </p>
    </div>
    <div class="c17">
      <p class="c19">
	<a href="#cmnt_ref3" id="cmnt3">[c]
	</a>
	<span class="c0">I should test whether the scsi power management udev rules for R7 play nice with the compute device
	</span>
      </p>
    </div>
    <div class="c17">
      <p class="c19">
	<a href="#cmnt_ref4" id="cmnt4">[d]
	</a>
	<span class="c0">Willing to bet it works fine. &nbsp;&#10084;&#65039;&#128148;&#129315; &nbsp;Probably some (very, very modest) increase in power usage. &nbsp;Important to focus on instructions for a universal PGPi host image so we can declare victory ASAP. &nbsp;Want to call this done and start discussion of desiderata for next release. &nbsp;And, eventually, a timetable.
	</span>
      </p>
    </div>
  </body>
</html>
